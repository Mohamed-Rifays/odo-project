<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoFinds Marketplace</title>
  <style>
    :root {
      --brand: #2E7D32;
      --shadow: 0 6px 18px rgba(0,0,0,0.25);
      --accent: rgba(255,255,255,0.95);
      --height: 52vh;
      --dot-size: 10px;
    }
    body { font-family: Inter, system-ui, sans-serif; margin: 0; background: #fafafa; }

    /* HEADER */
    .header {
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--brand);
      color: white;
      position: relative;
      z-index: 10;
    }
    .logo img { height: 40px; }
    .navigations { display: flex; gap: 20px; }
    .navigations a {
      color: white; text-decoration: none; font-weight: 500;
      cursor: pointer; transition: 0.2s;
    }
    .navigations a:hover { text-decoration: underline; }
    .cart-user { display: flex; align-items: center; gap: 15px; }
    .cart-logo { width: 32px; cursor: pointer; }
    .user-avatar {
      width: 35px; height: 35px; border-radius: 50%;
      object-fit: cover; cursor: pointer; display: flex; align-items: center; justify-content: center;
      background: #1b5e20; color: white; font-weight: bold; font-size: 18px;
    }

    /* SEARCH */
    .search-box { display: flex; justify-content: center; margin: 30px 0 15px 0; }
    .search-input-box {
      width: 600px; max-width: 90%; padding: 10px;
      border: 1px solid #ccc; border-radius: 10px; transition: 0.2s;
    }
    .search-input-box:hover {
      border-color: var(--brand);
      box-shadow: 0 0 5px rgba(46, 125, 50, 0.3);
    }

    /* OPTIONS */
    .options { display: flex; gap: 15px; justify-content: flex-end; margin: 0 20px 20px 20px; }
    .options select {
      padding: 8px 12px; border: 1px solid #aaa; border-radius: 6px;
      background: white; font-size: 14px; cursor: pointer; transition: 0.2s;
    }
    .options select:hover {
      border-color: var(--brand);
      box-shadow: 0 0 5px rgba(46, 125, 50, 0.3);
    }

    /* BANNER SLIDER */
    .banner-slider {
      position: relative; width: 100%; height: var(--height);
      overflow: hidden; background: #111;
    }
    .slide {
      position: absolute; inset: 0; display: grid; place-items: center;
      opacity: 0; transform: scale(1.02);
      transition: opacity .7s ease, transform .7s ease; pointer-events: none;
    }
    .slide.active { opacity: 1; transform: scale(1); pointer-events: auto; }
    .slide img { width: 100%; height: 100%; object-fit: cover; }
    .caption {
      position: absolute; left: 2rem; bottom: 2rem; max-width: 58%;
      color: var(--accent); padding: 1rem;
      background: rgba(46, 125, 50, 0.8); border-radius: 12px;
      box-shadow: var(--shadow); backdrop-filter: blur(4px);
    }
    .caption h2 { margin: 0 0 .35rem 0; font-size: clamp(18px, 3.2vw, 30px); }
    .caption p { margin: 0; opacity: .95; }
    .arrow {
      position: absolute; top: 50%; transform: translateY(-50%);
      width: 44px; height: 44px; border-radius: 50%;
      background: var(--brand); color: white;
      display: grid; place-items: center; cursor: pointer;
      box-shadow: var(--shadow); border: none; z-index: 6;
    }
    .arrow.left { left: 1rem; } .arrow.right { right: 1rem; }
    .dots {
      position: absolute; left: 50%; transform: translateX(-50%);
      bottom: 1rem; display: flex; gap: .5rem; z-index: 7;
    }
    .dot {
      width: var(--dot-size); height: var(--dot-size); border-radius: 50%;
      background: rgba(255,255,255,0.5); border: 2px solid var(--brand);
      cursor: pointer; transition: .3s;
    }
    .dot.active { background: var(--brand); transform: scale(1.1); }

    /* PRODUCTS */
    .products-section { padding: 20px; }
    .products-section h2 { margin-bottom: 15px; font-size: 22px; font-weight: bold; color: var(--brand); }
    .products-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px;
      
    }
    .product-card {
      border: 1px solid #ddd; border-radius: 12px; overflow: hidden;
      background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.2s; cursor: pointer;
    }
    .product-card:hover { transform: translateY(-5px); }
    .product-card img { width: 100%; height: 180px; object-fit: cover; }
    .product-info { padding: 12px; }
    .product-info h3 { margin: 0; font-size: 16px; font-weight: 600; color: #333; }
    .product-info p { margin: 6px 0; font-size: 14px; color: #666; }
    .product-info .price { color: var(--brand); font-weight: bold; font-size: 15px; }
  </style>
</head>
<body>
  <div class="landing-page"></div>

  <!-- React CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    function Header() {
      const [user, setUser] = React.useState(null);

      React.useEffect(() => {
        const token = localStorage.getItem("token");
        if (!token) return;

        fetch("/api/me", {
          headers: { "Authorization": "Bearer " + token }
        })
          .then(res => res.ok ? res.json() : null)
          .then(data => setUser(data))
          .catch(err => console.error("User fetch failed:", err));
      }, []);

      return (
        <div className="header">
          <div className="logo"><img src="img/logo.png" alt="EcoFinds Logo"/></div>
          <div className="navigations">
            <a href="listings.html">My Listings</a>
            <a href="add-product.html">Add Product</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
            {!user && <a href="login.html">Login</a>}
          </div>
          <div className="cart-user">
            {/* ✅ Cart always goes to cart.html */}
            <img
              className="cart-logo"
              src="img/cart-logo.png"
              alt="Cart"
              onClick={() => (window.location.href = "cart.html")}
            />
            {user ? (
              user.profile_pic ? (
                <img
                  className="user-avatar"
                  src={user.profile_pic}
                  alt={user.name}
                  onClick={() => (window.location.href = "profile.html")}
                />
              ) : (
                <div
                  className="user-avatar"
                  onClick={() => (window.location.href = "profile.html")}
                >
                  {user.name ? user.name[0].toUpperCase() : "U"}
                </div>
              )
            ) : (
              <div
                className="user-avatar"
                onClick={() => (window.location.href = "login.html")}
              >
                U
              </div>
            )}
          </div>
        </div>
      );
    }

    function Search() {
      return (
        <div className="search-box">
          <input className="search-input-box" type="text" placeholder="Search products..."/>
        </div>
      );
    }

    function Options() {
      return (
        <div className="options">
          <select defaultValue=""><option value="" disabled hidden>Sort By</option><option>Price: Low → High</option><option>Price: High → Low</option></select>
          <select defaultValue=""><option value="" disabled hidden>Filter By</option><option>Condition: New</option><option>Condition: Used</option></select>
          <select defaultValue=""><option value="" disabled hidden>Group By</option><option>Category</option><option>Price Range</option></select>
        </div>
      );
    }

    function Banner() {
      React.useEffect(() => {
        const slides = document.querySelectorAll('.slide');
        const dots = document.querySelectorAll('.dot');
        let current = 0;

        function goTo(i) {
          slides.forEach((s, idx) => s.classList.toggle('active', idx === i));
          dots.forEach((d, idx) => d.classList.toggle('active', idx === i));
          current = i;
        }
        function next() { goTo((current + 1) % slides.length); }
        function prev() { goTo((current - 1 + slides.length) % slides.length); }

        document.getElementById('next').onclick = next;
        document.getElementById('prev').onclick = prev;
        dots.forEach((d, i) => d.onclick = () => goTo(i));

        const timer = setInterval(next, 4000);
        return () => clearInterval(timer);
      }, []);

      return (
        <section className="banner-slider">
          <div className="slide active">
            <img src="img/slide-image-1.jpg" alt="Sustainable Living"/>
            <div className="caption"><h2>Welcome to EcoFinds</h2><p>Discover sustainable second-hand treasures today.</p></div>
          </div>
          <div className="slide">
            <img src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=1600&auto=format&fit=crop" alt="Second-hand Clothing"/>
            <div className="caption"><h2>Reduce. Reuse. Resell.</h2><p>Support the planet while shopping smart.</p></div>
          </div>
          <div className="slide">
            <img src="https://images.unsplash.com/photo-1585386959984-a4155223f7f9?q=80&w=1600&auto=format&fit=crop" alt="Eco-friendly Products"/>
            <div className="caption"><h2>Eco-Friendly Marketplace</h2><p>Join our community of conscious consumers.</p></div>
          </div>
          <button className="arrow left" id="prev">‹</button>
          <button className="arrow right" id="next">›</button>
          <div className="dots">
            <span className="dot active"></span>
            <span className="dot"></span>
            <span className="dot"></span>
          </div>
        </section>
      );
    }

    function Products() {
      const [products, setProducts] = React.useState([]);

      React.useEffect(() => {
        fetch("/api/products")
          .then(res => res.ok ? res.json() : [])
          .then(data => {
            if (data.length) setProducts(data);
            else {
              setProducts([
                { id: 1, name: "Eco Tote Bag", price: 15, description: "Reusable and stylish tote bag.", image: "img/tote-bag.jpg" },
                { id: 2, name: "Recycled Bottle", price: 10, description: "Eco-friendly reusable bottle.", image: "img/recycled-bottle.jpg" },
                { id: 3, name: "Bamboo Toothbrush", price: 5, description: "Sustainable bamboo toothbrush.", image: "img/bamboo-toothbrush.jpg" },
                { id: 4, name: "Organic T-Shirt", price: 20, description: "Soft cotton organic t-shirt.", image: "img/organic-tshirt.jpg" }
              ]);
            }
          })
          .catch(() => {
            setProducts([
              { id: 1, name: "Eco Tote Bag", price: 15, description: "Reusable and stylish tote bag.", image: "img/tote-bag.jpg" },
              { id: 2, name: "Recycled Bottle", price: 10, description: "Eco-friendly reusable bottle.", image: "img/recycled-bottle.jpg" },
              { id: 3, name: "Bamboo Toothbrush", price: 5, description: "Sustainable bamboo toothbrush.", image: "img/bamboo-toothbrush.jpg" },
              { id: 4, name: "Organic T-Shirt", price: 20, description: "Soft cotton organic t-shirt.", image: "img/organic-tshirt.jpg" }
            ]);
          });
      }, []);

      function goToProduct(id) {
        window.location.href = `product.html?id=${id}`;
      }

      return (
        <center>
        <section className="products-section">
          <h2>Products</h2>
         
          <div className="products-grid">
            {products.map((p) => (
              <div key={p.id || p._id} className="product-card" onClick={() => goToProduct(p.id || p._id)}>
                <img src={p.image || "img/placeholder.png"} alt={p.name}/>
                <div className="product-info">
                  <h3>{p.name}</h3>
                  <p className="price">${p.price}</p>
                  <p>{p.description}</p>
                </div>
              </div>
            ))}
          </div>
        </section>
        </center>
      );
    }

    function App() {
      return (
        <>
          <Header/>
          <Banner/>
          <Search/>
          <Options/>
          <Products/>
        </>
      );
    }

    const container = document.querySelector('.landing-page');
    const root = ReactDOM.createRoot(container);
    root.render(<App/>);
  </script>
</body>
</html>
